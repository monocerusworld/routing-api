import { Percent } from '@uniswap/sdk-core';
import { ChainId, MapWithLowerCaseKey, NATIVE_NAMES_BY_ID, nativeOnChain, } from '@tartz-one/smart-order-router';
export const DEFAULT_ROUTING_CONFIG_BY_CHAIN = (chainId) => {
    switch (chainId) {
        case ChainId.OPTIMISM:
        case ChainId.OPTIMISTIC_KOVAN:
            return {
                v2PoolSelection: {
                    topN: 3,
                    topNDirectSwaps: 1,
                    topNTokenInOut: 5,
                    topNSecondHop: 2,
                    topNWithEachBaseToken: 2,
                    topNWithBaseToken: 6,
                },
                v3PoolSelection: {
                    topN: 2,
                    topNDirectSwaps: 2,
                    topNTokenInOut: 2,
                    topNSecondHop: 1,
                    topNWithEachBaseToken: 3,
                    topNWithBaseToken: 3,
                },
                maxSwapsPerPath: 3,
                minSplits: 1,
                maxSplits: 7,
                distributionPercent: 10,
                forceCrossProtocol: false,
            };
        // Arbitrum calls have lower gas limits and tend to timeout more, which causes us to reduce the multicall
        // batch size and send more multicalls per quote. To reduce the amount of requests each quote sends, we
        // have to adjust the routing config so we explore fewer routes.
        case ChainId.ARBITRUM_ONE:
        case ChainId.ARBITRUM_RINKEBY:
            return {
                v2PoolSelection: {
                    topN: 3,
                    topNDirectSwaps: 1,
                    topNTokenInOut: 5,
                    topNSecondHop: 2,
                    topNWithEachBaseToken: 2,
                    topNWithBaseToken: 6,
                },
                v3PoolSelection: {
                    topN: 2,
                    topNDirectSwaps: 2,
                    topNTokenInOut: 2,
                    topNSecondHop: 1,
                    topNWithEachBaseToken: 3,
                    topNWithBaseToken: 2,
                },
                maxSwapsPerPath: 2,
                minSplits: 1,
                maxSplits: 7,
                distributionPercent: 25,
                forceCrossProtocol: false,
            };
        default:
            return {
                v2PoolSelection: {
                    topN: 3,
                    topNDirectSwaps: 1,
                    topNTokenInOut: 5,
                    topNSecondHop: 2,
                    topNWithEachBaseToken: 2,
                    topNWithBaseToken: 6,
                },
                v3PoolSelection: {
                    topN: 2,
                    topNDirectSwaps: 2,
                    topNTokenInOut: 3,
                    topNSecondHop: 1,
                    topNSecondHopForTokenAddress: new MapWithLowerCaseKey([
                        ['0x5f98805a4e8be255a32880fdec7f6728c6568ba0', 2], // LUSD
                    ]),
                    topNWithEachBaseToken: 3,
                    topNWithBaseToken: 5,
                },
                maxSwapsPerPath: 3,
                minSplits: 1,
                maxSplits: 7,
                distributionPercent: 5,
                forceCrossProtocol: false,
            };
    }
};
export async function tokenStringToCurrency(tokenListProvider, tokenProvider, tokenRaw, chainId, log) {
    const isAddress = (s) => s.length == 42 && s.startsWith('0x');
    let token = undefined;
    if (NATIVE_NAMES_BY_ID[chainId].includes(tokenRaw)) {
        token = nativeOnChain(chainId);
    }
    else if (isAddress(tokenRaw)) {
        token = await tokenListProvider.getTokenByAddress(tokenRaw);
    }
    if (!token) {
        token = await tokenListProvider.getTokenBySymbol(tokenRaw);
    }
    if (token) {
        log.info({
            tokenAddress: token.wrapped.address,
        }, `Got input token from token list`);
        return token;
    }
    log.info(`Getting input token ${tokenRaw} from chain`);
    if (!token && isAddress(tokenRaw)) {
        const tokenAccessor = await tokenProvider.getTokens([tokenRaw]);
        return tokenAccessor.getTokenByAddress(tokenRaw);
    }
    return undefined;
}
export function parseSlippageTolerance(slippageTolerance) {
    const slippagePer10k = Math.round(parseFloat(slippageTolerance) * 100);
    return new Percent(slippagePer10k, 10000);
}
export function parseDeadline(deadline) {
    return Math.floor(Date.now() / 1000) + parseInt(deadline);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2hhbmRsZXJzL3NoYXJlZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQVksT0FBTyxFQUFFLE1BQU0sbUJBQW1CLENBQUE7QUFDckQsT0FBTyxFQUVMLE9BQU8sRUFHUCxtQkFBbUIsRUFDbkIsa0JBQWtCLEVBQ2xCLGFBQWEsR0FDZCxNQUFNLCtCQUErQixDQUFBO0FBR3RDLE1BQU0sQ0FBQyxNQUFNLCtCQUErQixHQUFHLENBQUMsT0FBZ0IsRUFBcUIsRUFBRTtJQUNyRixRQUFRLE9BQU8sRUFBRTtRQUNmLEtBQUssT0FBTyxDQUFDLFFBQVEsQ0FBQztRQUN0QixLQUFLLE9BQU8sQ0FBQyxnQkFBZ0I7WUFDM0IsT0FBTztnQkFDTCxlQUFlLEVBQUU7b0JBQ2YsSUFBSSxFQUFFLENBQUM7b0JBQ1AsZUFBZSxFQUFFLENBQUM7b0JBQ2xCLGNBQWMsRUFBRSxDQUFDO29CQUNqQixhQUFhLEVBQUUsQ0FBQztvQkFDaEIscUJBQXFCLEVBQUUsQ0FBQztvQkFDeEIsaUJBQWlCLEVBQUUsQ0FBQztpQkFDckI7Z0JBQ0QsZUFBZSxFQUFFO29CQUNmLElBQUksRUFBRSxDQUFDO29CQUNQLGVBQWUsRUFBRSxDQUFDO29CQUNsQixjQUFjLEVBQUUsQ0FBQztvQkFDakIsYUFBYSxFQUFFLENBQUM7b0JBQ2hCLHFCQUFxQixFQUFFLENBQUM7b0JBQ3hCLGlCQUFpQixFQUFFLENBQUM7aUJBQ3JCO2dCQUNELGVBQWUsRUFBRSxDQUFDO2dCQUNsQixTQUFTLEVBQUUsQ0FBQztnQkFDWixTQUFTLEVBQUUsQ0FBQztnQkFDWixtQkFBbUIsRUFBRSxFQUFFO2dCQUN2QixrQkFBa0IsRUFBRSxLQUFLO2FBQzFCLENBQUE7UUFDSCx5R0FBeUc7UUFDekcsdUdBQXVHO1FBQ3ZHLGdFQUFnRTtRQUNoRSxLQUFLLE9BQU8sQ0FBQyxZQUFZLENBQUM7UUFDMUIsS0FBSyxP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RTtRQUNqQyxNQUFNLGFBQWEsR0FBRyxNQUFNLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFBO1FBQy9ELE9BQU8sYUFBYSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFBO0tBQ2pEO0lBRUQsT0FBTyxTQUFTLENBQUE7QUFDbEIsQ0FBQztBQUVELE1BQU0sVUFBVSxzQkFBc0IsQ0FBQyxpQkFBeUI7SUFDOUQsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsaUJBQWlCLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQTtJQUN0RSxPQUFPLElBQUksT0FBTyxDQUFDLGNBQWMsRUFBRSxLQUFNLENBQUMsQ0FBQTtBQUM1QyxDQUFDO0FBRUQsTUFBTSxVQUFVLGFBQWEsQ0FBQyxRQUFnQjtJQUM1QyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQTtBQUMzRCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ3VycmVuY3ksIFBlcmNlbnQgfSBmcm9tICdAdW5pc3dhcC9zZGstY29yZSdcbmltcG9ydCB7XG4gIEFscGhhUm91dGVyQ29uZmlnLFxuICBDaGFpbklkLFxuICBJVG9rZW5MaXN0UHJvdmlkZXIsXG4gIElUb2tlblByb3ZpZGVyLFxuICBNYXBXaXRoTG93ZXJDYXNlS2V5LFxuICBOQVRJVkVfTkFNRVNfQllfSUQsXG4gIG5hdGl2ZU9uQ2hhaW4sXG59IGZyb20gJ0B0YXJ0ei1vbmUvc21hcnQtb3JkZXItcm91dGVyJ1xuaW1wb3J0IExvZ2dlciBmcm9tICdidW55YW4nXG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX1JPVVRJTkdfQ09ORklHX0JZX0NIQUlOID0gKGNoYWluSWQ6IENoYWluSWQpOiBBbHBoYVJvdXRlckNvbmZpZyA9PiB7XG4gIHN3aXRjaCAoY2hhaW5JZCkge1xuICAgIGNhc2UgQ2hhaW5JZC5PUFRJTUlTTTpcbiAgICBjYXNlIENoYWluSWQuT1BUSU1JU1RJQ19LT1ZBTjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHYyUG9vbFNlbGVjdGlvbjoge1xuICAgICAgICAgIHRvcE46IDMsXG4gICAgICAgICAgdG9wTkRpcmVjdFN3YXBzOiAxLFxuICAgICAgICAgIHRvcE5Ub2tlbkluT3V0OiA1LFxuICAgICAgICAgIHRvcE5TZWNvbmRIb3A6IDIsXG4gICAgICAgICAgdG9wTldpdGhFYWNoQmFzZVRva2VuOiAyLFxuICAgICAgICAgIHRvcE5XaXRoQmFzZVRva2VuOiA2LFxuICAgICAgICB9LFxuICAgICAgICB2M1Bvb2xTZWxlY3Rpb246IHtcbiAgICAgICAgICB0b3BOOiAyLFxuICAgICAgICAgIHRvcE5EaXJlY3RTd2FwczogMixcbiAgICAgICAgICB0b3BOVG9rZW5Jbk91dDogMixcbiAgICAgICAgICB0b3BOU2Vjb25kSG9wOiAxLFxuICAgICAgICAgIHRvcE5XaXRoRWFjaEJhc2VUb2tlbjogMyxcbiAgICAgICAgICB0b3BOV2l0aEJhc2VUb2tlbjogMyxcbiAgICAgICAgfSxcbiAgICAgICAgbWF4U3dhcHNQZXJQYXRoOiAzLFxuICAgICAgICBtaW5TcGxpdHM6IDEsXG4gICAgICAgIG1heFNwbGl0czogNyxcbiAgICAgICAgZGlzdHJpYnV0aW9uUGVyY2VudDogMTAsXG4gICAgICAgIGZvcmNlQ3Jvc3NQcm90b2NvbDogZmFsc2UsXG4gICAgICB9XG4gICAgLy8gQXJiaXRydW0gY2FsbHMgaGF2ZSBsb3dlciBnYXMgbGltaXRzIGFuZCB0ZW5kIHRvIHRpbWVvdXQgbW9yZSwgd2hpY2ggY2F1c2VzIHVzIHRvIHJlZHVjZSB0aGUgbXVsdGljYWxsXG4gICAgLy8gYmF0Y2ggc2l6ZSBhbmQgc2VuZCBtb3JlIG11bHRpY2FsbHMgcGVyIHF1b3RlLiBUbyByZWR1Y2UgdGhlIGFtb3VudCBvZiByZXF1ZXN0cyBlYWNoIHF1b3RlIHNlbmRzLCB3ZVxuICAgIC8vIGhhdmUgdG8gYWRqdXN0IHRoZSByb3V0aW5nIGNvbmZpZyBzbyB3ZSBleHBsb3JlIGZld2VyIHJvdXRlcy5cbiAgICBjYXNlIENoYWluSWQuQVJCSVRSVU1fT05FOlxuICAgIGNhc2UgQ2hhaW5JZC5BUkJJVFJVTV9SSU5LRUJZOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdjJQb29sU2VsZWN0aW9uOiB7XG4gICAgICAgICAgdG9wTjogMyxcbiAgICAgICAgICB0b3BORGlyZWN0U3dhcHM6IDEsXG4gICAgICAgICAgdG9wTlRva2VuSW5PdXQ6IDUsXG4gICAgICAgICAgdG9wTlNlY29uZEhvcDogMixcbiAgICAgICAgICB0b3BOV2l0aEVhY2hCYXNlVG9rZW46IDIsXG4gICAgICAgICAgdG9wTldpdGhCYXNlVG9rZW46IDYsXG4gICAgICAgIH0sXG4gICAgICAgIHYzUG9vbFNlbGVjdGlvbjoge1xuICAgICAgICAgIHRvcE46IDIsXG4gICAgICAgICAgdG9wTkRpcmVjdFN3YXBzOiAyLFxuICAgICAgICAgIHRvcE5Ub2tlbkluT3V0OiAyLFxuICAgICAgICAgIHRvcE5TZWNvbmRIb3A6IDEsXG4gICAgICAgICAgdG9wTldpdGhFYWNoQmFzZVRva2VuOiAzLFxuICAgICAgICAgIHRvcE5XaXRoQmFzZVRva2VuOiAyLFxuICAgICAgICB9LFxuICAgICAgICBtYXhTd2Fwc1BlclBhdGg6IDIsXG4gICAgICAgIG1pblNwbGl0czogMSxcbiAgICAgICAgbWF4U3BsaXRzOiA3LFxuICAgICAgICBkaXN0cmlidXRpb25QZXJjZW50OiAyNSxcbiAgICAgICAgZm9yY2VDcm9zc1Byb3RvY29sOiBmYWxzZSxcbiAgICAgIH1cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdjJQb29sU2VsZWN0aW9uOiB7XG4gICAgICAgICAgdG9wTjogMyxcbiAgICAgICAgICB0b3BORGlyZWN0U3dhcHM6IDEsXG4gICAgICAgICAgdG9wTlRva2VuSW5PdXQ6IDUsXG4gICAgICAgICAgdG9wTlNlY29uZEhvcDogMixcbiAgICAgICAgICB0b3BOV2l0aEVhY2hCYXNlVG9rZW46IDIsXG4gICAgICAgICAgdG9wTldpdGhCYXNlVG9rZW46IDYsXG4gICAgICAgIH0sXG4gICAgICAgIHYzUG9vbFNlbGVjdGlvbjoge1xuICAgICAgICAgIHRvcE46IDIsXG4gICAgICAgICAgdG9wTkRpcmVjdFN3YXBzOiAyLFxuICAgICAgICAgIHRvcE5Ub2tlbkluT3V0OiAzLFxuICAgICAgICAgIHRvcE5TZWNvbmRIb3A6IDEsXG4gICAgICAgICAgdG9wTlNlY29uZEhvcEZvclRva2VuQWRkcmVzczogbmV3IE1hcFdpdGhMb3dlckNhc2VLZXk8bnVtYmVyPihbXG4gICAgICAgICAgICBbJzB4NWY5ODgwNWE0ZThiZTI1NWEzMjg4MGZkZWM3ZjY3MjhjNjU2OGJhMCcsIDJdLCAvLyBMVVNEXG4gICAgICAgICAgXSksXG4gICAgICAgICAgdG9wTldpdGhFYWNoQmFzZVRva2VuOiAzLFxuICAgICAgICAgIHRvcE5XaXRoQmFzZVRva2VuOiA1LFxuICAgICAgICB9LFxuICAgICAgICBtYXhTd2Fwc1BlclBhdGg6IDMsXG4gICAgICAgIG1pblNwbGl0czogMSxcbiAgICAgICAgbWF4U3BsaXRzOiA3LFxuICAgICAgICBkaXN0cmlidXRpb25QZXJjZW50OiA1LFxuICAgICAgICBmb3JjZUNyb3NzUHJvdG9jb2w6IGZhbHNlLFxuICAgICAgfVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB0b2tlblN0cmluZ1RvQ3VycmVuY3koXG4gIHRva2VuTGlzdFByb3ZpZGVyOiBJVG9rZW5MaXN0UHJvdmlkZXIsXG4gIHRva2VuUHJvdmlkZXI6IElUb2tlblByb3ZpZGVyLFxuICB0b2tlblJhdzogc3RyaW5nLFxuICBjaGFpbklkOiBDaGFpbklkLFxuICBsb2c6IExvZ2dlclxuKTogUHJvbWlzZTxDdXJyZW5jeSB8IHVuZGVmaW5lZD4ge1xuICBjb25zdCBpc0FkZHJlc3MgPSAoczogc3RyaW5nKSA9PiBzLmxlbmd0aCA9PSA0MiAmJiBzLnN0YXJ0c1dpdGgoJzB4JylcblxuICBsZXQgdG9rZW46IEN1cnJlbmN5IHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkXG5cbiAgaWYgKE5BVElWRV9OQU1FU19CWV9JRFtjaGFpbklkXSEuaW5jbHVkZXModG9rZW5SYXcpKSB7XG4gICAgdG9rZW4gPSBuYXRpdmVPbkNoYWluKGNoYWluSWQpXG4gIH0gZWxzZSBpZiAoaXNBZGRyZXNzKHRva2VuUmF3KSkge1xuICAgIHRva2VuID0gYXdhaXQgdG9rZW5MaXN0UHJvdmlkZXIuZ2V0VG9rZW5CeUFkZHJlc3ModG9rZW5SYXcpXG4gIH1cblxuICBpZiAoIXRva2VuKSB7XG4gICAgdG9rZW4gPSBhd2FpdCB0b2tlbkxpc3RQcm92aWRlci5nZXRUb2tlbkJ5U3ltYm9sKHRva2VuUmF3KVxuICB9XG5cbiAgaWYgKHRva2VuKSB7XG4gICAgbG9nLmluZm8oXG4gICAgICB7XG4gICAgICAgIHRva2VuQWRkcmVzczogdG9rZW4ud3JhcHBlZC5hZGRyZXNzLFxuICAgICAgfSxcbiAgICAgIGBHb3QgaW5wdXQgdG9rZW4gZnJvbSB0b2tlbiBsaXN0YFxuICAgIClcbiAgICByZXR1cm4gdG9rZW5cbiAgfVxuXG4gIGxvZy5pbmZvKGBHZXR0aW5nIGlucHV0IHRva2VuICR7dG9rZW5SYXd9IGZyb20gY2hhaW5gKVxuICBpZiAoIXRva2VuICYmIGlzQWRkcmVzcyh0b2tlblJhdykpIHtcbiAgICBjb25zdCB0b2tlbkFjY2Vzc29yID0gYXdhaXQgdG9rZW5Qcm92aWRlci5nZXRUb2tlbnMoW3Rva2VuUmF3XSlcbiAgICByZXR1cm4gdG9rZW5BY2Nlc3Nvci5nZXRUb2tlbkJ5QWRkcmVzcyh0b2tlblJhdylcbiAgfVxuXG4gIHJldHVybiB1bmRlZmluZWRcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlU2xpcHBhZ2VUb2xlcmFuY2Uoc2xpcHBhZ2VUb2xlcmFuY2U6IHN0cmluZyk6IFBlcmNlbnQge1xuICBjb25zdCBzbGlwcGFnZVBlcjEwayA9IE1hdGgucm91bmQocGFyc2VGbG9hdChzbGlwcGFnZVRvbGVyYW5jZSkgKiAxMDApXG4gIHJldHVybiBuZXcgUGVyY2VudChzbGlwcGFnZVBlcjEwaywgMTBfMDAwKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VEZWFkbGluZShkZWFkbGluZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgcmV0dXJuIE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApICsgcGFyc2VJbnQoZGVhZGxpbmUpXG59XG4iXX0=