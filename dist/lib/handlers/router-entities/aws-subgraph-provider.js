import { Protocol } from '@uniswap/router-sdk';
import { log, } from '@tartz-one/smart-order-router';
import { S3 } from 'aws-sdk';
import NodeCache from 'node-cache';
import { S3_POOL_CACHE_KEY } from '../../util/pool-cache-key';
const POOL_CACHE = new NodeCache({ stdTTL: 240, useClones: false });
const LOCAL_POOL_CACHE_KEY = (chainId, protocol) => `pools${chainId}#${protocol}`;
export class AWSSubgraphProvider {
    constructor(chain, protocol, bucket, baseKey) {
        this.chain = chain;
        this.protocol = protocol;
        this.bucket = bucket;
        this.baseKey = baseKey;
    }
    async getPools() {
        log.info(`In new AWS subgraph provider for protocol ${this.protocol}`);
        const cachedPools = POOL_CACHE.get(LOCAL_POOL_CACHE_KEY(this.chain, this.protocol));
        if (cachedPools) {
            log.info({ subgraphPoolsSample: cachedPools.slice(0, 5) }, `Subgraph pools fetched from local cache for protocol ${this.protocol}. Num: ${cachedPools.length}`);
            return cachedPools;
        }
        log.info({ bucket: this.bucket, key: this.baseKey }, `Subgraph pools local cache miss for protocol ${this.protocol}. Getting subgraph pools from S3`);
        const s3 = new S3();
        const pools = await cachePoolsFromS3(s3, this.bucket, this.baseKey, this.chain, this.protocol);
        return pools;
    }
}
export const cachePoolsFromS3 = async (s3, bucket, baseKey, chainId, protocol) => {
    const key = S3_POOL_CACHE_KEY(baseKey, chainId, protocol);
    let result;
    try {
        result = await s3.getObject({ Key: key, Bucket: bucket }).promise();
    }
    catch (err) {
        log.error({ bucket, key, err }, `Failed to get pools from S3 for ${protocol} on chain ${chainId}`);
        throw new Error(`Failed to get pools from S3 for ${protocol} on chain ${chainId}`);
    }
    const { Body: poolsBuffer } = result;
    if (!poolsBuffer) {
        throw new Error(`Could not get subgraph pool cache from S3 for protocol ${protocol} on chain ${chainId}`);
    }
    const pools = JSON.parse(poolsBuffer.toString('utf-8'));
    log.info({ bucket, key }, `Got subgraph pools from S3 for protocol ${protocol} on ${chainId}. Num: ${pools.length}`);
    POOL_CACHE.set(LOCAL_POOL_CACHE_KEY(chainId, protocol), pools);
    return pools;
};
export class V3AWSSubgraphProvider extends AWSSubgraphProvider {
    constructor(chainId, bucket, baseKey) {
        super(chainId, Protocol.V3, bucket, baseKey);
    }
    static async EagerBuild(bucket, baseKey, chainId) {
        const s3 = new S3();
        await cachePoolsFromS3(s3, bucket, baseKey, chainId, Protocol.V3);
        return new V3AWSSubgraphProvider(chainId, bucket, baseKey);
    }
}
export class V2AWSSubgraphProvider extends AWSSubgraphProvider {
    constructor(chainId, bucket, key) {
        super(chainId, Protocol.V2, bucket, key);
    }
    static async EagerBuild(bucket, baseKey, chainId) {
        const s3 = new S3();
        await cachePoolsFromS3(s3, bucket, baseKey, chainId, Protocol.V2);
        return new V2AWSSubgraphProvider(chainId, bucket, baseKey);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXdzLXN1YmdyYXBoLXByb3ZpZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vbGliL2hhbmRsZXJzL3JvdXRlci1lbnRpdGllcy9hd3Mtc3ViZ3JhcGgtcHJvdmlkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHFCQUFxQixDQUFBO0FBQzlDLE9BQU8sRUFJTCxHQUFHLEdBR0osTUFBTSwrQkFBK0IsQ0FBQTtBQUN0QyxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sU0FBUyxDQUFBO0FBQzVCLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQTtBQUU3RCxNQUFNLFVBQVUsR0FBRyxJQUFJLFNBQVMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUE7QUFDbkUsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLE9BQWdCLEVBQUUsUUFBa0IsRUFBRSxFQUFFLENBQUMsUUFBUSxPQUFPLElBQUksUUFBUSxFQUFFLENBQUE7QUFFcEcsTUFBTSxPQUFPLG1CQUFtQjtJQUM5QixZQUFvQixLQUFjLEVBQVUsUUFBa0IsRUFBVSxNQUFjLEVBQVUsT0FBZTtRQUEzRixVQUFLLEdBQUwsS0FBSyxDQUFTO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxZQUFPLEdBQVAsT0FBTyxDQUFRO0lBQUcsQ0FBQztJQUU1RyxLQUFLLENBQUMsUUFBUTtRQUNuQixHQUFHLENBQUMsSUFBSSxDQUFDLDZDQUE2QyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQTtRQUV0RSxNQUFNLFdBQVcsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFrQixvQkFBb0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxR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aUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUVqRixPQUFPLElBQUkscUJBQXFCLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQTtJQUM1RCxDQUFDO0NBQ0Y7QUFFRCxNQUFNLE9BQU8scUJBQXNCLFNBQVEsbUJBQW1DO0lBQzVFLFlBQVksT0FBZ0IsRUFBRSxNQUFjLEVBQUUsR0FBVztRQUN2RCxLQUFLLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQzFDLENBQUM7SUFFTSxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFjLEVBQUUsT0FBZSxFQUFFLE9BQWdCO1FBQzlFLE1BQU0sRUFBRSxHQUFHLElBQUksRUFBRSxFQUFFLENBQUE7UUFDbkIsTUFBTSxnQkFBZ0IsQ0FBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUVqRixPQUFPLElBQUkscUJBQXFCLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQTtJQUM1RCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcm90b2NvbCB9IGZyb20gJ0B1bmlzd2FwL3JvdXRlci1zZGsnXG5pbXBvcnQge1xuICBDaGFpbklkLFxuICBJVjJTdWJncmFwaFByb3ZpZGVyLFxuICBJVjNTdWJncmFwaFByb3ZpZGVyLFxuICBsb2csXG4gIFYyU3ViZ3JhcGhQb29sLFxuICBWM1N1YmdyYXBoUG9vbCxcbn0gZnJvbSAnQHRhcnR6LW9uZS9zbWFydC1vcmRlci1yb3V0ZXInXG5pbXBvcnQgeyBTMyB9IGZyb20gJ2F3cy1zZGsnXG5pbXBvcnQgTm9kZUNhY2hlIGZyb20gJ25vZGUtY2FjaGUnXG5pbXBvcnQgeyBTM19QT09MX0NBQ0hFX0tFWSB9IGZyb20gJy4uLy4uL3V0aWwvcG9vbC1jYWNoZS1rZXknXG5cbmNvbnN0IFBPT0xfQ0FDSEUgPSBuZXcgTm9kZUNhY2hlKHsgc3RkVFRMOiAyNDAsIHVzZUNsb25lczogZmFsc2UgfSlcbmNvbnN0IExPQ0FMX1BPT0xfQ0FDSEVfS0VZID0gKGNoYWluSWQ6IENoYWluSWQsIHByb3RvY29sOiBQcm90b2NvbCkgPT4gYHBvb2xzJHtjaGFpbklkfSMke3Byb3RvY29sfWBcblxuZXhwb3J0IGNsYXNzIEFXU1N1YmdyYXBoUHJvdmlkZXI8VFN1YmdyYXBoUG9vbCBleHRlbmRzIFYyU3ViZ3JhcGhQb29sIHwgVjNTdWJncmFwaFBvb2w+IHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjaGFpbjogQ2hhaW5JZCwgcHJpdmF0ZSBwcm90b2NvbDogUHJvdG9jb2wsIHByaXZhdGUgYnVja2V0OiBzdHJpbmcsIHByaXZhdGUgYmFzZUtleTogc3RyaW5nKSB7fVxuXG4gIHB1YmxpYyBhc3luYyBnZXRQb29scygpOiBQcm9taXNlPFRTdWJncmFwaFBvb2xbXT4ge1xuICAgIGxvZy5pbmZvKGBJbiBuZXcgQVdTIHN1YmdyYXBoIHByb3ZpZGVyIGZvciBwcm90b2NvbCAke3RoaXMucHJvdG9jb2x9YClcblxuICAgIGNvbnN0IGNhY2hlZFBvb2xzID0gUE9PTF9DQUNIRS5nZXQ8VFN1YmdyYXBoUG9vbFtdPihMT0NBTF9QT09MX0NBQ0hFX0tFWSh0aGlzLmNoYWluLCB0aGlzLnByb3RvY29sKSlcblxuICAgIGlmIChjYWNoZWRQb29scykge1xuICAgICAgbG9nLmluZm8oXG4gICAgICAgIHsgc3ViZ3JhcGhQb29sc1NhbXBsZTogY2FjaGVkUG9vbHMuc2xpY2UoMCwgNSkgfSxcbiAgICAgICAgYFN1YmdyYXBoIHBvb2xzIGZldGNoZWQgZnJvbSBsb2NhbCBjYWNoZSBmb3IgcHJvdG9jb2wgJHt0aGlzLnByb3RvY29sfS4gTnVtOiAke2NhY2hlZFBvb2xzLmxlbmd0aH1gXG4gICAgICApXG5cbiAgICAgIHJldHVybiBjYWNoZWRQb29sc1xuICAgIH1cblxuICAgIGxvZy5pbmZvKFxuICAgICAgeyBidWNrZXQ6IHRoaXMuYnVja2V0LCBrZXk6IHRoaXMuYmFzZUtleSB9LFxuICAgICAgYFN1YmdyYXBoIHBvb2xzIGxvY2FsIGNhY2hlIG1pc3MgZm9yIHByb3RvY29sICR7dGhpcy5wcm90b2NvbH0uIEdldHRpbmcgc3ViZ3JhcGggcG9vbHMgZnJvbSBTM2BcbiAgICApXG5cbiAgICBjb25zdCBzMyA9IG5ldyBTMygpXG5cbiAgICBjb25zdCBwb29scyA9IGF3YWl0IGNhY2hlUG9vbHNGcm9tUzM8VFN1YmdyYXBoUG9vbD4oczMsIHRoaXMuYnVja2V0LCB0aGlzLmJhc2VLZXksIHRoaXMuY2hhaW4sIHRoaXMucHJvdG9jb2wpXG5cbiAgICByZXR1cm4gcG9vbHNcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgY2FjaGVQb29sc0Zyb21TMyA9IGFzeW5jIDxUU3ViZ3JhcGhQb29sPihcbiAgczM6IFMzLFxuICBidWNrZXQ6IHN0cmluZyxcbiAgYmFzZUtleTogc3RyaW5nLFxuICBjaGFpbklkOiBDaGFpbklkLFxuICBwcm90b2NvbDogUHJvdG9jb2xcbikgPT4ge1xuICBjb25zdCBrZXkgPSBTM19QT09MX0NBQ0hFX0tFWShiYXNlS2V5LCBjaGFpbklkLCBwcm90b2NvbClcblxuICBsZXQgcmVzdWx0XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gYXdhaXQgczMuZ2V0T2JqZWN0KHsgS2V5OiBrZXksIEJ1Y2tldDogYnVja2V0IH0pLnByb21pc2UoKVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cuZXJyb3IoeyBidWNrZXQsIGtleSwgZXJyIH0sIGBGYWlsZWQgdG8gZ2V0IHBvb2xzIGZyb20gUzMgZm9yICR7cHJvdG9jb2x9IG9uIGNoYWluICR7Y2hhaW5JZH1gKVxuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGdldCBwb29scyBmcm9tIFMzIGZvciAke3Byb3RvY29sfSBvbiBjaGFpbiAke2NoYWluSWR9YClcbiAgfVxuXG4gIGNvbnN0IHsgQm9keTogcG9vbHNCdWZmZXIgfSA9IHJlc3VsdFxuXG4gIGlmICghcG9vbHNCdWZmZXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBnZXQgc3ViZ3JhcGggcG9vbCBjYWNoZSBmcm9tIFMzIGZvciBwcm90b2NvbCAke3Byb3RvY29sfSBvbiBjaGFpbiAke2NoYWluSWR9YClcbiAgfVxuXG4gIGNvbnN0IHBvb2xzID0gSlNPTi5wYXJzZShwb29sc0J1ZmZlci50b1N0cmluZygndXRmLTgnKSkgYXMgVFN1YmdyYXBoUG9vbFtdXG5cbiAgbG9nLmluZm8oeyBidWNrZXQsIGtleSB9LCBgR290IHN1YmdyYXBoIHBvb2xzIGZyb20gUzMgZm9yIHByb3RvY29sICR7cHJvdG9jb2x9IG9uICR7Y2hhaW5JZH0uIE51bTogJHtwb29scy5sZW5ndGh9YClcblxuICBQT09MX0NBQ0hFLnNldDxUU3ViZ3JhcGhQb29sW10+KExPQ0FMX1BPT0xfQ0FDSEVfS0VZKGNoYWluSWQsIHByb3RvY29sKSwgcG9vbHMpXG5cbiAgcmV0dXJuIHBvb2xzXG59XG5cbmV4cG9ydCBjbGFzcyBWM0FXU1N1YmdyYXBoUHJvdmlkZXIgZXh0ZW5kcyBBV1NTdWJncmFwaFByb3ZpZGVyPFYzU3ViZ3JhcGhQb29sPiBpbXBsZW1lbnRzIElWM1N1YmdyYXBoUHJvdmlkZXIge1xuICBjb25zdHJ1Y3RvcihjaGFpbklkOiBDaGFpbklkLCBidWNrZXQ6IHN0cmluZywgYmFzZUtleTogc3RyaW5nKSB7XG4gICAgc3VwZXIoY2hhaW5JZCwgUHJvdG9jb2wuVjMsIGJ1Y2tldCwgYmFzZUtleSlcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgYXN5bmMgRWFnZXJCdWlsZChidWNrZXQ6IHN0cmluZywgYmFzZUtleTogc3RyaW5nLCBjaGFpbklkOiBDaGFpbklkKTogUHJvbWlzZTxWM0FXU1N1YmdyYXBoUHJvdmlkZXI+IHtcbiAgICBjb25zdCBzMyA9IG5ldyBTMygpXG4gICAgYXdhaXQgY2FjaGVQb29sc0Zyb21TMzxWM1N1YmdyYXBoUG9vbD4oczMsIGJ1Y2tldCwgYmFzZUtleSwgY2hhaW5JZCwgUHJvdG9jb2wuVjMpXG5cbiAgICByZXR1cm4gbmV3IFYzQVdTU3ViZ3JhcGhQcm92aWRlcihjaGFpbklkLCBidWNrZXQsIGJhc2VLZXkpXG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFYyQVdTU3ViZ3JhcGhQcm92aWRlciBleHRlbmRzIEFXU1N1YmdyYXBoUHJvdmlkZXI8VjJTdWJncmFwaFBvb2w+IGltcGxlbWVudHMgSVYyU3ViZ3JhcGhQcm92aWRlciB7XG4gIGNvbnN0cnVjdG9yKGNoYWluSWQ6IENoYWluSWQsIGJ1Y2tldDogc3RyaW5nLCBrZXk6IHN0cmluZykge1xuICAgIHN1cGVyKGNoYWluSWQsIFByb3RvY29sLlYyLCBidWNrZXQsIGtleSlcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgYXN5bmMgRWFnZXJCdWlsZChidWNrZXQ6IHN0cmluZywgYmFzZUtleTogc3RyaW5nLCBjaGFpbklkOiBDaGFpbklkKTogUHJvbWlzZTxWMkFXU1N1YmdyYXBoUHJvdmlkZXI+IHtcbiAgICBjb25zdCBzMyA9IG5ldyBTMygpXG4gICAgYXdhaXQgY2FjaGVQb29sc0Zyb21TMzxWMlN1YmdyYXBoUG9vbD4oczMsIGJ1Y2tldCwgYmFzZUtleSwgY2hhaW5JZCwgUHJvdG9jb2wuVjIpXG5cbiAgICByZXR1cm4gbmV3IFYyQVdTU3ViZ3JhcGhQcm92aWRlcihjaGFpbklkLCBidWNrZXQsIGJhc2VLZXkpXG4gIH1cbn1cbiJdfQ==